"use strict";(self.webpackChunkproject_course=self.webpackChunkproject_course||[]).push([[949],{"./src/features/ArticleRating/ui/ArticleRating.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return ui_ArticleRating}});var _path,slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),query=__webpack_require__("./src/shared/api/query.ts"),i18n=__webpack_require__("./src/shared/config/i18n/index.ts"),articleRatingApi=query.p.injectEndpoints({endpoints:function(build){return{getArticleRating:build.query({query:function(_ref){return{url:"/article-ratings",params:{userId:_ref.userId,articleId:_ref.articleId}}},transformErrorResponse:function(response,meta,arg){return{title:i18n.Z.t("errors.loading",{ns:"article"}),text:i18n.Z.t("errors.loading",{ns:"article"})}}}),rateArticle:build.mutation({query:function(args){return{url:"/article-ratings",method:"POST",body:args}},transformErrorResponse:function(response,meta,arg){return{title:i18n.Z.t("errors.loading",{ns:"article"}),text:i18n.Z.t("errors.loading",{ns:"article"})}}})}}}),useRating=articleRatingApi.useGetArticleRatingQuery,useRateArticle=articleRatingApi.useRateArticleMutation,ui=__webpack_require__("./src/shared/ui/index.ts"),Flex=__webpack_require__("./src/shared/ui/Flex/index.ts"),Modal=__webpack_require__("./src/shared/ui/Modal/index.ts"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}var star=props=>react.createElement("svg",_extends({width:24,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg"},props),_path||(_path=react.createElement("path",{d:"M11.075 1.633c.32-.844 1.53-.844 1.852 0l2.07 5.734a.99.99 0 0 0 .926.633h5.087c.94 0 1.35 1.17.61 1.743L18 13a.968.968 0 0 0-.321 1.092L19 19.695c.322.9-.72 1.673-1.508 1.119l-4.917-3.12a1 1 0 0 0-1.15 0l-4.917 3.12c-.787.554-1.83-.22-1.508-1.119l1.322-5.603A.968.968 0 0 0 6 13L2.38 9.743C1.64 9.17 2.053 8 2.99 8h5.087a.989.989 0 0 0 .926-.633l2.07-5.734h0Z",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}))),Flex_Flex=__webpack_require__("./src/shared/ui/Flex/Flex.tsx"),Icon=__webpack_require__("./src/shared/ui/Icon/Icon.tsx"),StarRating_module_star="y43LHi0K",StarRating_module_active="FeD4e9gn",StarRating_module_selected="ouStZWWc",jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),StarRating=function(props){var rates=props.rates,onClick=props.onClick,_props$rate=props.rate,rate=void 0===_props$rate?0:_props$rate,_useState=(0,react.useState)(rate),_useState2=(0,slicedToArray.Z)(_useState,2),activeRate=_useState2[0],setActiveRate=_useState2[1],_useState3=(0,react.useState)(!1),_useState4=(0,slicedToArray.Z)(_useState3,2),isSelected=_useState4[0],setIsSelected=_useState4[1],onLeave=function(){!isSelected&&setActiveRate(0)},renderRates=rates.map((function(rate){return(0,jsx_runtime.jsx)(Icon.Z,{onClick:(id=rate,function(){!isSelected&&(null==onClick||onClick(id)),setIsSelected(!0)}),onMouseEnter:(index=rate,function(){console.log(index),!isSelected&&setActiveRate(index)}),onMouseLeave:onLeave,className:(0,clsx_m.Z)(StarRating_module_star,{[StarRating_module_active]:activeRate>=rate,[StarRating_module_selected]:isSelected}),SVG:star},rate);var index,id}));return(0,jsx_runtime.jsx)(Flex_Flex.Z,{children:renderRates})};StarRating.displayName="StarRating";var StarRating_StarRating=(0,react.memo)(StarRating);try{StarRating.displayName="StarRating",StarRating.__docgenInfo={description:"",displayName:"StarRating",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},rates:{defaultValue:null,description:"",name:"rates",required:!0,type:{name:"number[]"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((id: number) => void)"}},rate:{defaultValue:null,description:"",name:"rate",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/shared/ui/StarRating/StarRating.tsx#StarRating"]={docgenInfo:StarRating.__docgenInfo,name:"StarRating",path:"src/shared/ui/StarRating/StarRating.tsx#StarRating"})}catch(__react_docgen_typescript_loader_error){}var Rating=function(props){var onAccept=props.onAccept,onCancel=props.onCancel,feedbackTitle=props.feedbackTitle,rates=props.rates,title=props.title,_props$rate=props.rate,rate=void 0===_props$rate?0:_props$rate,_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1],_useState3=(0,react.useState)(""),_useState4=(0,slicedToArray.Z)(_useState3,2),feedback=_useState4[0],setFeedback=_useState4[1],_useState5=(0,react.useState)(rate),_useState6=(0,slicedToArray.Z)(_useState5,2),activeRate=_useState6[0],setActiveRate=_useState6[1],handleClose=function(){setIsModalOpen(!1),null==onCancel||onCancel(activeRate)},handleSave=function(){setIsModalOpen(!1),null==onAccept||onAccept(activeRate,feedback)},handleChange=function(value){setFeedback(value)};return(0,jsx_runtime.jsxs)(Flex.k,{align:"center",gap:"8",children:[(0,jsx_runtime.jsx)(ui.xv,{title:title}),(0,jsx_runtime.jsx)(StarRating_StarRating,{rate:rate,rates:rates,onClick:function(rate){feedbackTitle?(setActiveRate(rate),setIsModalOpen(!0)):null==onAccept||onAccept(rate)}}),isModalOpen?(0,jsx_runtime.jsx)(Modal.u,{onCloseOutside:handleClose,children:(0,jsx_runtime.jsxs)(Flex.k,{gap:"32",children:[(0,jsx_runtime.jsx)(ui.xv,{title:feedbackTitle}),(0,jsx_runtime.jsx)(ui.II,{onChange:handleChange}),(0,jsx_runtime.jsxs)(Flex.k,{children:[(0,jsx_runtime.jsx)(ui.zx,{onClick:handleClose,color:ui.rp.PRIMARY,children:"Закрыть"}),(0,jsx_runtime.jsx)(ui.zx,{onClick:handleSave,color:ui.rp.SECONDARY,children:"Сохранить"})]})]})}):null]})};Rating.displayName="Rating";var ui_Rating=(0,react.memo)(Rating);try{Rating.displayName="Rating",Rating.__docgenInfo={description:"",displayName:"Rating",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},feedbackTitle:{defaultValue:null,description:"",name:"feedbackTitle",required:!1,type:{name:"string"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!1,type:{name:"((star: number) => void)"}},onAccept:{defaultValue:null,description:"",name:"onAccept",required:!1,type:{name:"((star: number, feedback?: string) => void)"}},rates:{defaultValue:null,description:"",name:"rates",required:!0,type:{name:"number[]"}},rate:{defaultValue:null,description:"",name:"rate",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/Rating/ui/Rating.tsx#Rating"]={docgenInfo:Rating.__docgenInfo,name:"Rating",path:"src/entities/Rating/ui/Rating.tsx#Rating"})}catch(__react_docgen_typescript_loader_error){}var User=__webpack_require__("./src/entities/User/index.ts"),Skeleton=__webpack_require__("./src/shared/ui/Skeleton/index.ts"),rates=[1,2,3,4,5],ArticleRating=function(props){var _data$at,id=props.id,t=(0,useTranslation.$)("article").t,user=(0,es.v9)(User.PR),_useRating=useRating({articleId:id||"",userId:(null==user?void 0:user.id)||""}),isLoading=_useRating.isLoading,data=_useRating.data;console.log(data,"data");var _useRateArticle=useRateArticle(),rateArticleMutation=(0,slicedToArray.Z)(_useRateArticle,1)[0],handleClick=(0,react.useCallback)((function(rate,feedback){rateArticleMutation({articleId:id||"",userId:(null==user?void 0:user.id)||"",rate:rate,feedback:feedback})}),[id,null==user?void 0:user.id,rateArticleMutation]),onAccept=(0,react.useCallback)((function(rate,feedback){handleClick(rate,feedback)}),[handleClick]),onCancel=(0,react.useCallback)((function(rate){handleClick(rate)}),[handleClick]);if(isLoading)return(0,jsx_runtime.jsx)(Skeleton.O,{width:"100%",height:"50px"});var rate=null==data||null===(_data$at=data.at(-1))||void 0===_data$at?void 0:_data$at.rate;return console.log(rate,"rate"),(0,jsx_runtime.jsx)(ui_Rating,{onAccept:onAccept,onCancel:onCancel,title:t("articleRateTitle"),rates:rates,feedbackTitle:t("feedbackTitle"),rate:rate})};ArticleRating.displayName="ArticleRating";var ui_ArticleRating=ArticleRating;try{ArticleRating.displayName="ArticleRating",ArticleRating.__docgenInfo={description:"",displayName:"ArticleRating",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/features/ArticleRating/ui/ArticleRating.tsx#ArticleRating"]={docgenInfo:ArticleRating.__docgenInfo,name:"ArticleRating",path:"src/features/ArticleRating/ui/ArticleRating.tsx#ArticleRating"})}catch(__react_docgen_typescript_loader_error){}}}]);